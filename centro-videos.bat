@echo off
title Pacific Labs LMS - Centro de Videos
color 0B

:inicio
cls
echo.
echo   üé¨ PACIFIC LABS LMS - CENTRO DE VIDEOS
echo   ====================================
echo.
echo   Tu sistema completo para gestionar videos educativos
echo   con Google Cloud Storage y organizaci√≥n autom√°tica.
echo.
echo   üìã OPCIONES DISPONIBLES:
echo.
echo      1. üöÄ Subir video (Drag ^& Drop)
echo      2. üì§ Subir video (Paso a paso)  
echo      3. üîç Verificar sistema
echo      4. üìÇ Ver estructura de cursos
echo      5. üåê Abrir LMS en navegador
echo      6. üìö Ver gu√≠a de uso
echo      7. ‚ùì Ayuda y soporte
echo      0. üö™ Salir
echo.

set /p opcion="Selecciona una opci√≥n (0-7): "

if "%opcion%"=="1" goto drag_drop
if "%opcion%"=="2" goto paso_a_paso  
if "%opcion%"=="3" goto verificar
if "%opcion%"=="4" goto estructura
if "%opcion%"=="5" goto abrir_lms
if "%opcion%"=="6" goto guia
if "%opcion%"=="7" goto ayuda
if "%opcion%"=="0" goto salir

echo ‚ùå Opci√≥n no v√°lida
timeout /t 2 >nul
goto inicio

:drag_drop
cls
echo.
echo   üöÄ SUBIDA R√ÅPIDA (DRAG ^& DROP)
echo   ==============================
echo.
echo   La forma M√ÅS F√ÅCIL de subir videos:
echo.
echo   üìÅ PASO 1: Encuentra tu video en el explorador
echo   üéØ PASO 2: Arrastra el video sobre: subir-video-express.bat
echo   ‚ö° PASO 3: ¬°Se sube autom√°ticamente!
echo.
echo   ‚ú® CARACTER√çSTICAS:
echo      ‚Ä¢ Subida autom√°tica a Google Cloud
echo      ‚Ä¢ Organizaci√≥n en cursos/secciones/lecciones
echo      ‚Ä¢ Actualizaci√≥n autom√°tica de la base de datos
echo      ‚Ä¢ T√≠tulo autom√°tico desde nombre del archivo
echo.
echo   üéì CONFIGURACI√ìN ACTUAL:
echo      ‚Ä¢ Curso por defecto: IA B√°sico
echo      ‚Ä¢ Secci√≥n por defecto: 1
echo      ‚Ä¢ Lecci√≥n por defecto: 1
echo.

echo   üìù ¬øQuieres cambiar la configuraci√≥n por defecto?
set /p cambiar="   (s/N): "

if /i "%cambiar%"=="s" (
    echo.
    echo   ‚öôÔ∏è Para cambiar la configuraci√≥n:
    echo      1. Abre upload-express.js en un editor
    echo      2. Busca CONFIG_RAPIDA
    echo      3. Modifica curso, seccion, leccion
    echo      4. Guarda el archivo
    echo.
    pause
)

echo.
echo   üí° CONSEJO: Si es tu primer video, ejecuta primero
echo      la opci√≥n 3 (Verificar sistema) para asegurarte
echo      de que todo est√° configurado correctamente.
echo.
pause
goto inicio

:paso_a_paso
cls
echo.
echo   üì§ SUBIDA PASO A PASO
echo   ====================
echo.
echo   Proceso guiado para subir videos con m√°s control:
echo.

REM Verificar que los archivos necesarios existen
if not exist "upload-video-simple.js" (
    echo   ‚ùå Error: Script no encontrado
    echo      Aseg√∫rate de tener upload-video-simple.js
    pause
    goto inicio
)

if not exist ".env" (
    echo   ‚ùå Error: Configuraci√≥n no encontrada
    echo      Necesitas configurar el archivo .env primero
    echo.
    echo   üí° Ejecuta la opci√≥n 3 para verificar el sistema
    pause
    goto inicio
)

echo   üöÄ Iniciando proceso guiado...
echo.
pause

REM Ejecutar script interactivo
node upload-video-simple.js

echo.
echo   ‚úÖ Proceso completado
pause
goto inicio

:verificar
cls
echo.
echo   üîç VERIFICACI√ìN DEL SISTEMA
echo   ==========================
echo.
echo   Comprobando que todo est√° configurado correctamente...
echo.

if not exist "test-upload-ready.js" (
    echo   ‚ö†Ô∏è Script de verificaci√≥n no encontrado
    echo      Creando verificaci√≥n b√°sica...
    echo.
    
    REM Verificaci√≥n b√°sica manual
    echo   üìã Verificaci√≥n Manual:
    echo.
    
    if exist ".env" (
        echo      ‚úÖ Archivo .env encontrado
    ) else (
        echo      ‚ùå Archivo .env NO encontrado
    )
    
    if exist "google-cloud-credentials.json" (
        echo      ‚úÖ Credenciales de Google Cloud encontradas
    ) else (
        echo      ‚ùå Credenciales de Google Cloud NO encontradas
    )
    
    if exist "upload-express.js" (
        echo      ‚úÖ Script de subida express encontrado
    ) else (
        echo      ‚ùå Script de subida express NO encontrado
    )
    
    echo.
    echo   üí° Si hay archivos faltantes, ejecuta:
    echo      setup-complete-advanced.bat
    
) else (
    echo   üß™ Ejecutando verificaci√≥n completa...
    echo.
    node test-upload-ready.js
)

echo.
pause
goto inicio

:estructura
cls
echo.
echo   üìÇ ESTRUCTURA DE CURSOS
echo   ======================
echo.
echo   Organizaci√≥n autom√°tica de videos:
echo.
echo   üì¶ Google Cloud Storage Bucket
echo   ‚îî‚îÄ‚îÄ üìÅ cursos/
echo       ‚îú‚îÄ‚îÄ üìÅ ia-basico/               (IA B√°sico)
echo       ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ seccion-1/
echo       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ leccion-1/       ‚Üí üé¨ videos aqu√≠
echo       ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ leccion-2/       ‚Üí üé¨ videos aqu√≠
echo       ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ leccion-3/       ‚Üí üé¨ videos aqu√≠
echo       ‚îÇ   ‚îú‚îÄ‚îÄ üìÅ seccion-2/
echo       ‚îÇ   ‚îî‚îÄ‚îÄ üìÅ seccion-3/
echo       ‚îú‚îÄ‚îÄ üìÅ ia-intermedio/           (IA Intermedio)
echo       ‚îú‚îÄ‚îÄ üìÅ ia-avanzado/             (IA Avanzado)
echo       ‚îú‚îÄ‚îÄ üìÅ ml-fundamentals/         (ML Fundamentals)
echo       ‚îî‚îÄ‚îÄ üìÅ deep-learning/           (Deep Learning)
echo.
echo   üéì CURSOS DISPONIBLES:
echo      ‚Ä¢ ia-basico      ‚Üí IA B√°sico - Certificaci√≥n Profesional
echo      ‚Ä¢ ia-intermedio  ‚Üí IA Intermedio - Certificaci√≥n Profesional
echo      ‚Ä¢ ia-avanzado    ‚Üí IA Avanzado - Certificaci√≥n Profesional
echo      ‚Ä¢ ml-fundamentals ‚Üí Machine Learning Fundamentals  
echo      ‚Ä¢ deep-learning  ‚Üí Deep Learning Especializaci√≥n
echo.
echo   üìù EJEMPLO DE URL GENERADA:
echo      https://storage.googleapis.com/tu-bucket/
echo      cursos/ia-basico/seccion-1/leccion-1/introduccion-ia.mp4
echo.
pause
goto inicio

:abrir_lms
cls
echo.
echo   üåê ABRIENDO LMS EN NAVEGADOR
echo   ===========================
echo.
echo   Intentando abrir tu LMS...
echo.

REM Verificar si el servidor est√° corriendo
echo   üîç Verificando si el servidor est√° activo...

REM Intentar hacer ping a localhost:3000
for /f %%i in ('powershell -command "try{(Invoke-WebRequest -Uri 'http://localhost:3000' -TimeoutSec 5).StatusCode}catch{404}"') do set status=%%i

if "%status%"=="200" (
    echo   ‚úÖ Servidor activo en http://localhost:3000
    echo   üöÄ Abriendo en navegador...
    start http://localhost:3000
) else (
    echo   ‚ö†Ô∏è Servidor no detectado en puerto 3000
    echo.
    echo   üí° Para iniciar tu LMS:
    echo      1. Abre una terminal
    echo      2. Ejecuta: npm run dev
    echo      3. Espera a que inicie
    echo      4. Abre: http://localhost:3000
    echo.
    set /p iniciar="¬øQuieres intentar iniciarlo ahora? (s/N): "
    
    if /i "%iniciar%"=="s" (
        echo.
        echo   üöÄ Iniciando servidor LMS...
        echo   (Esto puede tomar unos momentos)
        echo.
        start cmd /k "npm run dev"
        
        echo   ‚è≥ Esperando que el servidor inicie...
        timeout /t 10 >nul
        
        echo   üåê Intentando abrir navegador...
        start http://localhost:3000
    )
)

echo.
pause
goto inicio

:guia
cls
echo.
echo   üìö GU√çA DE USO R√ÅPIDA
echo   ====================
echo.
echo   üé¨ C√ìMO SUBIR TU PRIMER VIDEO:
echo.
echo   1Ô∏è‚É£ PREPARACI√ìN:
echo      ‚Ä¢ Aseg√∫rate de que tu video est√© en formato .mp4
echo      ‚Ä¢ Verifica que el sistema est√© configurado (opci√≥n 3)
echo.
echo   2Ô∏è‚É£ SUBIDA R√ÅPIDA:
echo      ‚Ä¢ Arrastra tu video sobre: subir-video-express.bat
echo      ‚Ä¢ O usa la opci√≥n 1 de este men√∫
echo.
echo   3Ô∏è‚É£ SUBIDA PERSONALIZADA:
echo      ‚Ä¢ Usa la opci√≥n 2 para elegir curso/secci√≥n/lecci√≥n
echo      ‚Ä¢ Agrega t√≠tulo y descripci√≥n personalizados
echo.
echo   4Ô∏è‚É£ VERIFICACI√ìN:
echo      ‚Ä¢ Abre tu LMS (opci√≥n 5)
echo      ‚Ä¢ Ve a cursos y verifica que aparece tu video
echo.
echo   üéØ FORMATOS SOPORTADOS:
echo      ‚úÖ .mp4 (recomendado)     ‚úÖ .webm
echo      ‚úÖ .avi                   ‚úÖ .mov
echo      ‚úÖ .mkv
echo.
echo   üìè L√çMITES:
echo      ‚Ä¢ Tama√±o m√°ximo: 500 MB por video
echo      ‚Ä¢ Sin l√≠mite de duraci√≥n
echo.
echo   üí∞ COSTOS:
echo      ‚Ä¢ Google Cloud Storage: ~$0.02/GB/mes
echo      ‚Ä¢ Ejemplo: 20 videos = ~$1/mes
echo.
pause
goto inicio

:ayuda
cls
echo.
echo   ‚ùì AYUDA Y SOPORTE
echo   =================
echo.
echo   üÜò PROBLEMAS COMUNES:
echo.
echo   ‚ùå "Error: Google Cloud credentials not found"
echo      ‚Üí Agrega google-cloud-credentials.json
echo      ‚Üí Descarga desde Google Cloud Console
echo.
echo   ‚ùå "Error: Bucket does not exist"  
echo      ‚Üí Crea bucket en Google Cloud Console
echo      ‚Üí Actualiza GOOGLE_CLOUD_BUCKET_NAME en .env
echo.
echo   ‚ùå "Error: Database connection failed"
echo      ‚Üí Verifica DATABASE_URL en .env
echo      ‚Üí Ejecuta: npx prisma db push
echo.
echo   ‚ùå "Formato no soportado"
echo      ‚Üí Convierte tu video a .mp4
echo      ‚Üí Usa Handbrake (gratis) o VLC
echo.
echo   üìö DOCUMENTACI√ìN COMPLETA:
echo      ‚Ä¢ GUIA-SUBIR-VIDEOS.md - Gu√≠a espec√≠fica de videos
echo      ‚Ä¢ README-COMPLETO.md - Documentaci√≥n completa
echo      ‚Ä¢ SISTEMA_VIDEOS_GUIA_COMPLETA.md - Gu√≠a t√©cnica
echo.
echo   üîß HERRAMIENTAS DE DIAGN√ìSTICO:
echo      ‚Ä¢ test-upload-ready.js - Verificaci√≥n completa
echo      ‚Ä¢ test-system-advanced.js - Test del sistema
echo.
echo   üí¨ CONTACTO:
echo      ‚Ä¢ Email: soporte@pacificlabs.com
echo      ‚Ä¢ Documentaci√≥n: README-COMPLETO.md
echo.
pause
goto inicio

:salir
cls
echo.
echo   üëã ¬°GRACIAS POR USAR PACIFIC LABS LMS!
echo   ====================================
echo.
echo   üé¨ Tu sistema de videos est√° listo para:
echo      ‚Ä¢ Subir contenido educativo
echo      ‚Ä¢ Organizar cursos autom√°ticamente  
echo      ‚Ä¢ Gestionar miles de estudiantes
echo.
echo   üí° RECORDATORIOS:
echo      ‚Ä¢ Haz backups regulares de tus videos
echo      ‚Ä¢ Monitorea el uso de Google Cloud Storage
echo      ‚Ä¢ Mant√©n actualizado tu LMS
echo.
echo   üåê Tu LMS estar√° en: http://localhost:3000
echo.
echo   üìö Para m√°s informaci√≥n consulta:
echo      GUIA-SUBIR-VIDEOS.md
echo.
pause
exit